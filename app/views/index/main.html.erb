<h1>Environmental Chamber Data</h1>
<%= javascript_include_tag "//www.google.com/jsapi" %>

<%= line_chart @thing_data_short.
  group_by_minute('env_data.created_at', series: false, format: "%F %R %z").
  #group_by_minute('env_data.created_at', series: false, format: "%F %H").
  average(:temp_c),
  library: {
    title: 'Temperature',
    vAxis: {
      title: '°C',
      gridlines: {count: 12}
    },
    hAxis: {
      title: "#{Date.yesterday.strftime("%A %F")} to #{Date.today.strftime("%A %F")}",
      slantedText: true,
      gridlines: {count: 24}
    },
  }, adapter: "google" %>

<%= line_chart @thing_data_short.
  group_by_minute('env_data.created_at', series: false, format: "%F %R %z").
  #group_by_minute('env_data.created_at', series: false, format: "%F %H").
  average(:humidity),
  library: {
    title: 'Humidity',
    vAxis: {
      title: "Percent (%)",
      gridlines: {count: 12}
    },
    hAxis: {
      title: "#{Date.yesterday.strftime("%A %F")} to #{Date.today.strftime("%A %F")}",
      slantedText: true,
      gridlines: {count: 24}
    },
  }, adapter: "google" %>

<%= line_chart @thing_data_long.
  group_by_minute('env_data.created_at', series: false, format: "%F %R %z").
  #group_by_minute('env_data.created_at', series: false, format: "%F %H").
  average(:temp_c),
  library: {
    title: 'Temperature',
    vAxis: {
      title: '°C',
      gridlines: {count: 12}
    },
    hAxis: {
      title: "#{Date.yesterday.strftime("%A %F")} to #{Date.today.strftime("%A %F")}",
      slantedText: true,
      gridlines: {count: 24}
    },
  }, adapter: "google" %>

<%= line_chart @thing_data_long.
  group_by_minute('env_data.created_at', series: false, format: "%F %R %z").
  #group_by_minute('env_data.created_at', series: false, format: "%F %H").
  average(:humidity),
  library: {
    title: 'Humidity',
    vAxis: {
      title: "Percent (%)",
      gridlines: {count: 12}
    },
    hAxis: {
      title: "#{Date.yesterday.strftime("%A %F")} to #{Date.today.strftime("%A %F")}",
      slantedText: true,
      gridlines: {count: 24}
    },
  }, adapter: "google" %>

<p>EnvData count: <%= @data_count %></p>

<%= yield :charts_js %>
